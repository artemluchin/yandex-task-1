"use strict";function readFromJson(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),200!=t.status?(alert(t.status+": "+t.statusText),!1):JSON.parse(t.responseText)}function makeCurrentDate(e){return e.setFullYear(2016),e.setMonth(3),e.setDate(13),e}function getDate(e){var t=e.replace(/(^\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})\W([\+||\-]\d{2})(\d{2})/,"$1-$2-$3T$4:$5:$6.000$7:$8"),n=Date.parse(t),a=new Date(n);return a}function getWeekDay(e){var t=["вс","пн","вт","ср","чт","пт","сб"];return t[e.getDay()]}function modifyDate(e){return e.toTimeString().slice(0,5)}function getChannelName(e){return tv.channel.filter(function(t){return t.id===e})[0]["display-name"].text}function getChannelLogoPath(e){return tv.channel.filter(function(t){return t.id===e})[0].icon.src}function getFirstDateOfWeek(e){var t=new Date;return 0!==e.getDay()?t.setDate(e.getDate()-e.getDay()+1):t.setDate(e.getDate()-6),t}function getLastDateOfWeek(e){var t=new Date;return 0!==e.getDay()?t.setDate(e.getDate()+7-e.getDay()):t=e,t}function isToday(e,t){return e.getDay()===t.getDay()}function renderGrid(e){$(".grid__list").empty(),tv.channel.forEach(function(t){$(".grid__list").append(renderChannel(t.id,e))})}function renderChannel(e,t){var n=getChannelName(e),a=getChannelLogoPath(e);return'\n  <div class="channel">\n    <div class="channel__title">\n      <div class="channel__logo">\n        <img src="'+a+'"></img>\n      </div>\n      <div class="channel__name">'+n+'</div>\n    </div>\n    <div class="channel-events">'+renderEvents(e,t)+"</div>\n  </div>\n  "}function renderEvents(e,t){var n="";return tv.programme.forEach(function(a,r){if(a.channel===e){var i=getDate(a.start),s=getDate(a.stop),c=currentDate>i?"channel-events__item-expired":"",d=currentDate>i&&s>currentDate?"channel-events__item-on-air":"",l=a.title.text.slice(0,a.title.text.length-6),o=a.category?a.category.text:"";i.getDate()===t.getDate()&&(n+='\n          <div data-programmeId="'+r+'" class="channel-events__item '+c+" "+d+'" data-category="'+o+'">\n            <div class="channel-events__time">'+modifyDate(i)+'</div>\n            <div class="channel-events__name">'+l+"</div>\n          </div>\n        ")}}),n}function renderFilters(){$(".filters__days").append(renderDays()),$(".filters__days-select select").append(renderSelectDays())}function renderDays(){for(var e="",t=getFirstDateOfWeek(currentDate),n=getLastDateOfWeek(currentDate);n>=t;){var a=t.getDay()<currentDate.getDay()&&0!==t.getDay()?"filters__days-item-expired":"",r=0==t.getDay()||6==t.getDay()?"filters__days-item-weekend":"",i=isToday(t,currentDate)?"filters__days-item_active":"";e+='\n      <div data-date="'+t.toISOString()+'" class="filters__days-item '+a+" "+r+" "+i+'">\n        '+(isToday(t,currentDate)?"Сегодня":t.getDate()+", "+getWeekDay(t))+"\n      </div>\n    ",t=new Date(t.setDate(t.getDate()+1))}return e}function renderSelectDays(){for(var e="",t=getFirstDateOfWeek(currentDate),n=getLastDateOfWeek(currentDate);n>=t;)e+='\n      <option value="'+t.toISOString()+'"'+(isToday(t,currentDate)?" selected":"")+">"+(isToday(t,currentDate)?"Сегодня":t.getDate()+", "+getWeekDay(t))+"</option>\n    ",t=new Date(t.setDate(t.getDate()+1));return e}function switchDay(){var e=new Date($(this).data("date"));$(this).parent().children().removeClass("filters__days-item_active"),$(this).addClass("filters__days-item_active"),renderGrid(e),$(".filters__genres").children().each(function(e,t){var n=$(t).data("genre");$(t).hasClass("filters__genres-"+n+"_active")&&$('[data-category="'+n+'"] > .channel-events__time').toggleClass("channel-events__item-"+n)})}function switchDaySelect(){var e=new Date($(this).val());renderGrid(e)}function setGenre(){var e=$(this).data("genre");$('[data-category="'+e+'"] > .channel-events__time').toggleClass("channel-events__item-"+e),$(this).toggleClass("filters__genres-"+e+"_active")}function switchGenresSelect(){var e=$(this).val();$(".channel").show(),e?$(".channel").each(function(t,n){$(n).has('[data-category="'+e+'"]').length||$(n).hide(),$(n).find(".channel-events__item").each(function(t,n){$(n).data("category")===e?$(n).show():$(n).hide()})}):$(".channel-events__item").show()}function showDescription(){var e=this,t=$(this).data("programmeid"),n=tv.programme[t].title.text.slice(0,tv.programme[t].title.text.length-6),a=tv.programme[t].desc?tv.programme[t].desc.text:"К сожалению, для данной передачи описание отсутствует.",r='\n  <div class="desc-window">\n    <div class="programme-image">\n      <img src="/dist/images/img.png"></img>\n    </div>\n    <div class="programme-title">'+n+'</div>\n    <div class="programme-desc">'+a+"</div>\n  </div>\n";timeout=setTimeout(function(){$(e).append(r)},800)}function hideDescription(){clearTimeout(timeout),$(this).find(".desc-window").remove()}var filePath="dist/data/tv.json",tv=readFromJson(filePath),currentDate=makeCurrentDate(new Date),timeout=void 0;$(document).ready(function(){renderFilters(),renderGrid(currentDate),$(".filters__days").on("click",".filters__days-item",switchDay),$(".filters__days-select").on("change","select",switchDaySelect),$(".filters__genres-select").on("change","select",switchGenresSelect),$(".filters__genres").on("click",".filters__genres-item",setGenre),$(".grid__list").on("mouseenter",".channel-events__item",showDescription),$(".grid__list").on("mouseleave",".channel-events__item",hideDescription)});